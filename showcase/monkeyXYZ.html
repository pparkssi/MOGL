<!DOCTYPE html>
<html lang="ko">
<head>
    <title>Monkey</title>
    <meta charset="utf-8"/>
    <meta property="og:image" content="http://shallaa.github.io/SoftEngine/og/1.jpg"/>
    <meta property="og:title" content="Monkey"/>
    <meta property="og:description" content="MoGL.js version"/>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
    <meta name="format-detection" content="telephone=no"/>
    <meta name="apple-mobile-web-app-capable" content="yes"/>
    <meta name="apple-mobile-web-app-status-bar-style" content="black"/>
    <meta name="viewport"
          content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no,target-densitydpi=high-dpi "/>
    <style>
        body {
            background-color: #000;
            margin: 0;
            padding: 0;
            overflow: hidden;
            height: 100%;
        }

        .FPS {
            color: #FFF;
            left: 0px;
            top: 0px;
            position: absolute
        }
    </style>
    <script src="../src/MoGL.js"></script>
    <script src="../src/BlendMode.js"></script>
    <script src="../src/Filter.js"></script>
    <script src="../src/Vertex.js"></script>
    <script src="../src/Shading.js"></script>
    <script src="../src/VertexShaderFunctions.js"></script>
    <script src="../src/Matrix.js"></script>
    <script src="../src/Geometry.js"></script>
    <script src="../src/Material.js"></script>
    <script src="../src/Texture.js"></script>
    <script src="../src/Mesh.js"></script>
    <script src="../src/Group.js"></script>
    <script src="../src/Camera.js"></script>
    <script src="../src/Scene.js"></script>
    <script src="../src/World.js"></script>
    <script src="../showcase/dat.gui.min.js"></script>
</head>
<body>
<canvas id="canvas"></canvas>
<script>
    'use strict';

    var world = new World('canvas');
    var scene = new Scene();
    var testMat = new Material()
    world.addScene(scene);
    world.setAutoSize(1)
    scene.addChild('camera', new Camera());
    scene.addMaterial('material', testMat);
    scene.addTexture('texture', 'monkey/Suzanne.jpg');
    scene.getMaterial('material').addTexture(Texture.diffuse, 'texture');


    var xmlhttp = new XMLHttpRequest();
    xmlhttp.open('GET', 'monkey/monkey.babylon', true);
    xmlhttp.onreadystatechange = function () {
        if (xmlhttp.readyState === 4 && xmlhttp.status === 200) {
            start(JSON.parse(xmlhttp.responseText));
        }
    };
    xmlhttp.send(null);
    function start(json) {
        var mesh = json.meshes[0];
        var vertices = mesh.vertices;
        var indices = mesh.indices;
        var uvCount = mesh.uvCount;
        var verticesStep = 1;
        switch (uvCount) {
            case 0:
                verticesStep = 6;
                break;
            case 1:
                verticesStep = 8;
                break;
            case 2:
                verticesStep = 10;
                break;
        }
        var verticesCount = vertices.length / verticesStep;
        var facesCount = indices.length / 3;
        var vertex = [];
        var index = [];
        var i = 0;
        var j;
        for (; i < verticesCount; i++) {
            j = i * verticesStep;
            vertex.push(vertices[j], vertices[j + 1], vertices[j + 2], vertices[j + 3], vertices[j + 4], vertices[j + 5]);
            if (uvCount > 0) {
                vertex.push(vertices[j + 6], vertices[j + 7]);
            } else {
                vertex.push(0, 0);
            }
        }
        for (i = 0; i < facesCount; i++) {
            j = i * 3;
            index.push(indices[j], indices[j + 1], indices[j + 2]);
        }
        scene.addGeometry('geometry', new Geometry(vertex, index, [Vertex.x, Vertex.y, Vertex.z, Vertex.normalX, Vertex.normalY, Vertex.normalZ, Vertex.u, Vertex.v]));

        var mesh = new Mesh('geometry', 'material');
        scene.addChild('monkey', mesh);
        mesh.getMaterial().setShading(Shading.phong)
        mesh.getMaterial().setLambert(2)

        mesh.rotateY = Math.PI


        world.start()


        ///////////////////////////////////////////////////
        // UI
        ///////////////////////////////////////////////////
        var controllerParams = {
            x: 0,
            y: 0,
            z: 0,
            rotateX: 0,
            rotateY: Math.PI,
            rotateZ: 0,
            scaleX: 1,
            scaleY: 1,
            scaleZ: 1
        };
        var shadingParams = {
            color: function () {
                testMat.removeTexture('texture');
                testMat.setShading(Shading.none)
            },
            toon: function () {
                testMat.removeTexture('texture');
                testMat.setShading(Shading.toon)
            },
            PhongColor: function () {
                testMat.removeTexture('texture');
                testMat.setShading(Shading.phong)
            },
            GouraudColor: function () {
                testMat.removeTexture('texture');
                testMat.setShading(Shading.gouraud)
            },
            GouraudTextrue: function () {
                testMat.removeTexture('texture');
                testMat.addTexture(Texture.diffuse, 'texture');
                testMat.setShading(Shading.gouraud)
            },
            PhongTextrue: function () {
                testMat.removeTexture('texture');
                testMat.addTexture(Texture.diffuse, 'texture');
                testMat.setShading(Shading.phong)
            }
        };
        var gui = new dat.GUI();
        var panel = gui.addFolder('position');
        panel.add(controllerParams, 'x', -5, 5).onChange(function (value) {
            mesh.x = value
        })
        panel.add(controllerParams, 'y', -5, 5).onChange(function (value) {
            mesh.y = value
        })
        panel.add(controllerParams, 'z', -5, 5).onChange(function (value) {
            mesh.z = value
        })
        panel.add(controllerParams, 'rotateX', -Math.PI, Math.PI).onChange(function (value) {
            mesh.rotateX = value
        })
        panel.add(controllerParams, 'rotateY', -Math.PI, Math.PI).onChange(function (value) {
            mesh.rotateY = value
        })
        panel.add(controllerParams, 'rotateZ', -Math.PI, Math.PI).onChange(function (value) {
            mesh.rotateZ = value
        })
        panel.add(controllerParams, 'scaleX', 0.1, 5).onChange(function (value) {
            mesh.scaleX = value
        })
        panel.add(controllerParams, 'scaleY', 0.1, 5).onChange(function (value) {
            mesh.scaleY = value
        })
        panel.add(controllerParams, 'scaleZ', 0.1, 5).onChange(function (value) {
            mesh.scaleZ = value
        })
        panel.open()
        var shading = gui.addFolder('Shading');
        shading.add(shadingParams, 'color');
        shading.add(shadingParams, 'toon');
        shading.add(shadingParams, 'GouraudColor');
        shading.add(shadingParams, 'PhongColor');
        shading.add(shadingParams, 'GouraudTextrue');
        shading.add(shadingParams, 'PhongTextrue');
    }
</script>
</body>
</html>