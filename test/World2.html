<!DOCTYPE html>
<html lang="ko">
<head>
    <title>MoGL Test Suite - World.js</title>
    <meta charset="utf-8"/>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
    <meta name="format-detection" content="telephone=no"/>
    <meta name="apple-mobile-web-app-capable" content="yes"/>
    <meta name="apple-mobile-web-app-status-bar-style" content="black"/>
    <meta name="viewport"
          content="width=device-width,user-scalable=no,initial-scale=1.0,maximum-scale=1.0,minimum-scale=1.0,target densitydpi=high-dpi"/>
    <link rel="stylesheet" type="text/css" href="css.css"/>
</head>
<body>
<img src="../src/ohno.png"/>
<canvas id="canvasTest" style="position: absolute"></canvas>
<canvas id="canvasTest2" style="position: absolute"></canvas>
<canvas id="canvasTest3" style="position: absolute"></canvas>
<div id="stage"></div>
<div id="result"></div>
<div id="test"></div>
<script src="../src/MoGL.js"></script>
<script src="../src/BlendMode.js"></script>
<script src="../src/Filter.js"></script>
<script src="../src/Vertex.js"></script>
<script src="../src/VertexShaderFunctions.js"></script>
<script src="../src/Matrix.js"></script>
<script src="../src/Shading.js"></script>
<script src="../src/Shader.js"></script>
<script src="../src/Geometry.js"></script>
<script src="../src/Material.js"></script>
<script src="../src/Texture.js"></script>
<script src="../src/Mesh.js"></script>
<script src="../src/Group.js"></script>
<script src="../src/Camera.js"></script>
<script src="../src/Scene.js"></script>
<script src="../src/World.js"></script>
<script src="http://js.bsapi.co/test/"></script>
<script>
    var world = new World('canvasTest');
    var resultTemp
    bsTest('World 0.3 New',
            function () {
                // MoGL 객체의 uuid는 MoGL객체.toString() 과 같다
                return world.uuid
            }, world.toString(),
            function () {
                //'World.constructor:0' - 캔버스 아이디가 없을때
                resultTemp = 1
                try {
                    new World();
                } catch (e) {
                    resultTemp = 0
                }
                return resultTemp
            }, 0,
            function () {
                //'World.constructor:1' - 존재하지않는 Dom id일때
                resultTemp = 1
                try {
                    new World('noID');
                } catch (e) {
                    resultTemp = 0
                }
                return resultTemp
            }, 0,
            function () {
                //'World.constructor:2' - GLcontext생성 실패
                // 이건어찌 테스트하지?
                //                resultTemp = 1
                //                try {
                //                    new World('noID');
                //                } catch (e) {
                //                    resultTemp = e.toString()
                //                }
                return 0
            }, 0
    )

    world = new World('canvasTest');
    //    world.setAutoSize(1)
    var testScene = Scene()
    var testScene2 = Scene().setId('redcamel')
    bsTest('addScene,getScene',
            function () {
                // id로 등록된 씬 확인
                world.addScene(testScene);
                return world.getScene('wantNull')
            }, null,
            function () {
                // id로 등록된 씬 확인
                world.addScene(testScene2);
                return world.getScene(testScene2.id).id
            }, testScene2.id,
            function () {
                // id를 바꾸고 난뒤에도 찾아져야겠지!
                testScene2.setId('changeID')
                return world.getScene(testScene2.id).id
            }, 'changeID'
    )
    world = new World('canvasTest');
    testScene2 = Scene().setId('redcamel2')
    bsTest('removeScene',
            function () {
                // 아이디로 삭제후 다시 찾아봄
                world.addScene(testScene2)
                world.removeScene('redcamel2')
                return world.getScene('redcamel2')
            }, null,
            function () {
                return world.getScene(testScene2)
            }, null,
            function () {
                // 없는게 확인되었으니 같은 씬을 등록해도 통과해야함
                world.addScene(testScene2)
                return world.getScene('redcamel2')
            }, testScene2
    )
    //    world.getRenderer()
    //    world.getRenderer()
    //    world.getRenderer()
    //    world.getRenderer(1)
    //    world.getRenderer(1)
    //    world.getRenderer(1)


    testScene2.addChild(new Camera().setId('testCamera'))
    //
    world.addEventListener(World.renderBefore, function () {
        console.log('렌더전에 실행되자~~')
    })
    world.addEventListener(World.renderBefore, test2)
    //    world.removeEventListener(World.renderBefore, test2)

    function test2() {
        console.log('렌더전에 실행되자~2~')
    }
    world.addEventListener(World.renderAfter, function () {
        console.log('렌더후에 실행되자~~')
    })
    world.render()
    //                world.getRenderer()()
    //        setInterval(world.getRenderer(), 300)

    var result_str = "";
    function before_fn() {
        result_str += "_renderBefore2";
    }
    bsTest('eventListener - renderBefore, renderAfter',
            function () {             // before anonymous fn
                world.addEventListener(World.renderBefore, function () {
                    result_str += "_renderBefore";
                });
                result_str = "start";
                world.render();
                result_str += "_end";
                return result_str.indexOf("start_renderBefore_end") > -1;
            }, true,
            function () {              // before fn
                world.addEventListener(World.renderBefore, before_fn);
                result_str = "start";
                world.render();
                result_str += "_end";
                return result_str.indexOf("start_renderBefore_renderBefore2_end") > -1;
            }, true,
            function () {             // after anonymous fn
                world.addEventListener(World.renderAfter, function () {
                    result_str += "_renderAfter"
                });
                result_str = "start";
                world.render();
                result_str += "_end";
                return result_str.indexOf("start_renderBefore_renderBefore2_renderAfter_end") > -1;
            }, true
    );


</script>
</body>
</html>
