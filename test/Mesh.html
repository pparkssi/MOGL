<!DOCTYPE html>
<html lang="ko">
<head>
    <title>MoGL Test Suite - Mesh.js</title>
    <meta charset="utf-8"/>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
    <meta name="format-detection" content="telephone=no"/>
    <meta name="apple-mobile-web-app-capable" content="yes"/>
    <meta name="apple-mobile-web-app-status-bar-style" content="black"/>
    <meta name="viewport"
          content="width=device-width,user-scalable=no,initial-scale=1.0,maximum-scale=1.0,minimum-scale=1.0,target-densitydpi=medium-dpi"/>
    <link rel="stylesheet" type="text/css" href="css.css"/>
</head>
<body>
<img src="../src/ohno.png">
<canvas id="canvas"></canvas>
<div id="stage"></div>
<div id="result"></div>
<div id="test"></div>
<script src="../src/MoGL.js"></script>
<!--<script src="../src/BlendMode.js"></script>-->
<!--<script src="../src/Filter.js"></script>-->
<!--<script src="../src/Vertex.js"></script>-->
<script src="../src/VertexShaderFunctions.js"></script>
<script src="../src/Shader.js"></script>
<script src="../src/Shading.js"></script>
<script src="../src/Matrix.js"></script>
<script src="../src/Geometry.js"></script>
<script src="../src/Material.js"></script>
<!--<script src="../src/Texture.js"></script>-->
<script src="../src/Mesh.js"></script>
<!--<script src="../src/Group.js"></script>-->
<!--<script src="../src/Camera.js"></script>-->
<script src="../src/Scene.js"></script>
<script src="../src/World.js"></script>
<script src="http://js.bsapi.co/test/"></script>
<script>
    var world = new World('canvas')
    var tGeo = new Geometry([], [])
    var tMat = new Material('#f00')
    var tMat2 = new Material('#f00')
    var mesh1 = new Mesh(tGeo, tMat);
    //    var mesh2 = new Mesh(new Geometry([], []), new Material('#f00'));
    //    var mesh3 = Mesh('cube', 'mat1');
    //    var mesh4 = Mesh(null, null);
    var testGeometry1 = new Geometry([], []);
    var testGeometry2 = new Geometry([], []);
    //    var tMat = Material('#f00');
    //    var tMat2 = Material('#f00');
    //
    var testScene = Scene();
    world.addScene(testScene)
    //    testScene.addMaterial("red", new Material("#ff0000"));
    //    testScene.addGeometry("triangle", new Geometry([-1, 0, 0, 1, 0, 0, 0, 1, 0], [0, 1, 2]));
    //    var mesh5 = Mesh("triangle", "red");
    //    var mesh6 = Mesh("triangle", "red");
    //
    var tempGeo, tempMaterial;
    var temp;
    bsTest('new',
            function () {
                // new Mesh('cube', 'mat1');
                return mesh1.isAlive;
            }, true,
            function () {
                try {
                    new Mesh('키가 들어가있으면 등록이되면안됨', '재질도마찬가지!')
                } catch (e) {
                    return false
                }
                return true;
            }, false
//            function () {
//                // Mesh('cube', 'mat1');
//                return mesh3.isAlive;
//            }, true,
//            function () {
//                // Mesh();
//                return mesh4.isAlive;
//            }, true
    );
    bsTest('Geometry',
            function () {
                // 신에 등록하기전
                return mesh1.geometry;
            }, tGeo
//            function () {
//                mesh1.geometry = new Geometry();
//                return mesh1.getGeometry();
//            }, null
    );
    bsTest('Material',
            function () {
                // 신에 등록하기전
                return mesh1.material;
            }, tMat
    );
    bsTest('after AddChild',
            function () {
                // 씬에 등록후 지오메트리가 제대로 찾아지나 점검
                testScene.addChild(mesh1.setId('testMesh1'));
                testScene.getChild('testMesh1').geometry = tGeo;
                tempGeo = testScene.getChild('testMesh1').geometry
                return tempGeo;
            }, tGeo,
                function () {
                    // 등록된 녀석이 지오메트리 형식이냐?
                    return tempGeo instanceof Geometry;
                }, true,
                function () {
                    // 잘 바뀌나 테스트
                    mesh1.geometry = testGeometry2;
                    return mesh1.geometry ;
                }, testGeometry2,
                function () {
                    // 씬에 등록후 재질이 제대로 찾아지나 점검
                    testScene.getChild('testMesh1').material = tMat;
                    tempMaterial = testScene.getChild('testMesh1').material
                    return tempMaterial;
                }, tMat,
                function () {
                    // 등록된 녀석이 Material 형식이냐..
                    tempMaterial = testScene.getChild('testMesh1').material;
                    return tempMaterial instanceof Material;
                }, true,
                function () {
                    // 잘 바뀌나 테스트
                    mesh1.material = tMat2;
                    return mesh1.material;
                }, tMat2,
                function () {
                    try {
                        // 이미 씬에 등록된 mesh 에 Geometry를 바꿈
                        mesh1.material = new Geometry([],[])
                    }catch(e){
                        console.log(e);
                        return false;
                    }
                }, false,
                function () {
                    try {
                        // 이미 씬에 등록된 mesh 에 Geometry 에 null 입력
                        mesh1.geometry = null
                    }catch(e){
                        console.log(e);
                        return false;
                    }
                }, false,
                function () {
                    try {
                        // 이미 씬에 등록된 mesh 에 Material 바꿈
                        mesh1.material = new Material('#222')
                    }catch(e){
                        console.log(e);
                        return false;
                    }
                },undefined
    )
    //

    bsTest('position',
            function () {
                // Position - return type
                temp = mesh1.position;
                return temp instanceof Float32Array
            }, true,
            function () {
                // Position - no param - initialization
                mesh1.position = [0, 0, 0];
                return mesh1.x == 0 && mesh1.y == 0 && mesh1.z == 0;
            }, true,
            function () {
                // Position - x, y, z
                mesh1.position = [10, 20, 30];
                return mesh1.x == 10 && mesh1.y == 20 && mesh1.z == 30;
            }, true,
            function () {
                // Position
                temp = mesh1.position;
                return mesh1.x == temp[0] && mesh1.y == temp[1] && mesh1.z == temp[2];
            }, true,
            function () {
                // Position
                mesh1.x = 11, mesh1.y = 12, mesh1.z = 13;
                temp = mesh1.position;
                return mesh1.x == temp[0] && mesh1.y == temp[1] && mesh1.z == temp[2];
            }, true
    )
    bsTest('rotation',
            function () {
                // rotation - return type
                temp = mesh1.rotate;
                return temp instanceof Float32Array
            }, true,
            function () {
                // rotation - no param - initialization
                mesh1.rotate = [0, 0, 0];
                return mesh1.rotateX == 0 && mesh1.rotateY == 0 && mesh1.rotateZ == 0;
            }, true,
            function () {
                // rotation - 1 array param [rotateX, rotateY, rotateZ]
                mesh1.rotate = [10, 20, 30];
                return mesh1.rotateX == 10 && mesh1.rotateY == 20 && mesh1.rotateZ == 30;
            }, true,
            function () {
                // rotation - rotateX, rotateY, rotateZ
                mesh1.rotate = [10, 20, 30];
                return mesh1.rotateX == 10 && mesh1.rotateY == 20 && mesh1.rotateZ == 30;
            }, true,
            function () {
                // rotation
                temp = mesh1.rotate;
                return mesh1.rotateX == temp[0] && mesh1.rotateY == temp[1] && mesh1.rotateZ == temp[2];
            }, true,
            function () {
                // rotation
                mesh1.rotateX = 11, mesh1.rotateY = 12, mesh1.rotateZ = 13
                temp = mesh1.rotate;
                return mesh1.rotateX == temp[0] && mesh1.rotateY == temp[1] && mesh1.rotateZ == temp[2];
            }, true
    )
    bsTest('scale',
            function () {
                // scale - return type
                temp = mesh1.scale;
                return temp instanceof Float32Array
            }, true,
            function () {
                // scale - no param - initialization
                mesh1.scale = [1, 1, 1];
                return mesh1.scaleX == 1 && mesh1.scaleY == 1 && mesh1.scaleZ == 1;
            }, true,
            function () {
                // scale - 1 array param [scaleX, scaleY, scaleZ]
                mesh1.scale = [10, 20, 30];
                return mesh1.scaleX == 10 && mesh1.scaleY == 20 && mesh1.scaleZ == 30;
            }, true,
            function () {
                // scale - scaleX, scaleY, scaleZ
                mesh1.scale = [10, 20, 30];
                return mesh1.scaleX == 10 && mesh1.scaleY == 20 && mesh1.scaleZ == 30;
            }, true,
            function () {
                // scale
                temp = mesh1.scale;
                return mesh1.scaleX == temp[0] && mesh1.scaleY == temp[1] && mesh1.scaleZ == temp[2];
            }, true,
            function () {
                // scale
                mesh1.scaleX = 11, mesh1.scaleY = 12, mesh1.scaleZ = 13;
                temp = mesh1.scale;
                return mesh1.scaleX == temp[0] && mesh1.scaleY == temp[1] && mesh1.scaleZ == temp[2];
            }, true
    )
    //
    bsTest('Matrix',
            function () {
                // type check
                return mesh1.matrix instanceof Matrix;
            }, true,
            //TODO 먼가 검증이 필요하군?
            function () {
                // getMatrix - init
                mesh1.matIdentity()
                return mesh1.matStr();
            }, "Matrix(1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1)",
            function () {
                // getMatrix - psoition change
                mesh1.matIdentity()
                mesh1.scale = [1,1,1]
                mesh1.rotate = [0,0,0]
                mesh1.position = [3, 6, 9];

                return mesh1.matrix.matStr();
            }, "Matrix(1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 3, 6, 9, 1)",
            function () {
                // getMatrix - scale change
                mesh1.matIdentity()
                mesh1.position = [0, 0, 0]
                mesh1.rotate = [0, 0, 0]
                mesh1.scale = [10, 20, 30];

                return mesh1.matrix.matStr();
            }, "Matrix(10, 0, 0, 0, 0, 20, 0, 0, 0, 0, 30, 0, 0, 0, 0, 1)"
    )

//    mesh1.destroy();
//    bsTest('destroy',
//            function () {
//                return mesh1;
//            }, undefined
//    );


</script>
</body>
</html>